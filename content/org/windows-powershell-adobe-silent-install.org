* Windows Powershell Adobe Reader 32bit Silent Installer
** How it works 
- Uninstalls Adobe
- Download and install the Adobe Enterprise Installer
- Parse the DC Release Notes page to pull the latest patch file
- Installs the Latest Patch

The script downloads and installs Adobe using a hardcoded link.
It scrapes the DC Release Notes page to download the most recent patch file and then installs it silently.
This will get Adobe to the most recent release. Everything is done silently.

This disables all forms of Adobe updates.
Remove _AdobeSettings from the last line to suppress this function.

** The script
Powershell v4 is required

#+begin_src shell
$ProgressPreference="SilentlyContinue"
$cwd=$PSScriptRoot

# Fetch the uninstall string for adobe
function _UninstallAdobe{
    # Fetch the uninstall string for Adobe and grab the product id of it
    $progs=Get-ChildItem -Path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall, HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall | Get-ItemProperty
    # Uninstalling it silently
    try{
        Write-Host "Uninstalling Adobe if it's installed."
        (($progs | Where {$_.displayname -match "Adobe Acrobat.*DC"}).uninstallstring) -match "{.*.}" | Out-Null
        Start-Process "msiexec.exe" -ArgumentList "/X $($matches[0]) /qn" -Wait
    } catch {
        "Couldn't find Adobe Acrobat Reader. Installing it."
    }
}

function _InstallAdobe{
    Write-Host "Downloading Adobe."
    Invoke-WebRequest -Uri 'https://ardownload2.adobe.com/pub/adobe/reader/win/AcrobatDC/2200120085/AcroRdrDC2200120085_en_US.exe' -OutFile "$env:temp\adobereader.exe" -UseBasicParsing
    $hashItShouldBe="3656695886E2E7A62A6C321DA1A22593"
    $hash=Get-FileHash $env:temp\adobereader.exe -Algorithm MD5
    if ($hash.hash -ne $hashItShouldBe){
      Write-Host "MD5Sum didn't match. Redownloading Adobe."
      Write-Host "The installer will run regardless if the MD5Sum doesn't match a second time."
      Invoke-WebRequest -Uri 'https://ardownload2.adobe.com/pub/adobe/reader/win/AcrobatDC/2200120085/AcroRdrDC2200120085_en_US.exe' -OutFile "$env:temp\adobereader.exe" -UseBasicParsing
    }
    Write-Host "Installing Adobe."
    Start-Process "$env:temp\adobereader.exe" -ArgumentList "/sAll /rs /msi EULA_ACCEPT=YES" -Wait
}

function _InstallLatestPatch{
    Write-Host "Locating the latest Adobe patch file for this month."
    $base="https://www.adobe.com/devnet-docs/acrobatetk/tools/ReleaseNotesDC/"
    $link=(Invoke-WebRequest -Uri "https://www.adobe.com/devnet-docs/acrobatetk/tools/ReleaseNotesDC/index.html" -UseBasicParsing).links.href | Select-String "continuous/dccontinuous" | Select -First 1
    $link = $base+$link

    Write-Host "Downloading the latest Adobe patch file."
    # After finding the patch notes for the month, let's parse out the URL for the latest patch file
    $patchlink=(Invoke-WebRequest -Uri "$link" -UseBasicParsing).links.href | Select-String "pub/adobe/reader/win/AcrobatDC/" | Select -First 1
    # Get the filename from the url and download it
    $filename=([uri]"$patchlink").Segments[-1]
    # Download the patch.msp
    Invoke-WebRequest -Uri "$patchlink" -OutFile "$env:temp/$filename" -UseBasicParsing
    Write-Host "Installing the patch."
    Start-Process "$env:temp/$filename" -ArgumentList "/qn" -Wait
}

function _AdobeSettings{
    Write-Host "Disabling the update task, update services, update registry keys, and enhanced security mode."
    # Prevent autoupdates (not necessary with the enterprise edition)
    Disable-ScheduledTask -TaskName "Adobe Acrobat Update Task"
    Stop-Service -Name "Adobe Acrobat Update Service"
    Set-Service -Name "AdobeARMservice" -StartupType Disabled
    # Disables and locks down the update button
    New-Item "HKLM:\Software\WOW6432Node\Policies\Adobe\Acrobat Reader\DC" -ErrorAction SilentlyContinue
    New-Item "HKLM:\Software\WOW6432Node\Policies\Adobe\Acrobat Reader\DC\FeatureLockDown" -ErrorAction SilentlyContinue
    New-ItemProperty "HKLM:\Software\WOW6432Node\Policies\Adobe\Acrobat Reader\DC\FeatureLockDown" -Name "Mode" -Value 0 -PropertyType DWORD -Force
    New-ItemProperty "HKLM:\Software\WOW6432Node\Policies\Adobe\Acrobat Reader\DC\FeatureLockDown" -Name "bUpdater" -Value 0 -PropertyType DWORD -Force
    New-ItemProperty "HKLM:\Software\WOW6432Node\Policies\Adobe\Acrobat Reader\DC\FeatureLockDown" -Name "bProtectedModeValue" -Value 0 -PropertyType DWORD -Force
    # This *should* disable enhanced security mode
    New-ItemProperty "HKLM:\Software\WOW6432Node\Policies\Adobe\Acrobat Reader\DC\FeatureLockDown" -Name "bEnhancedSecurityStandalone" -Value 0 -PropertyType DWORD -Force
    New-ItemProperty "HKLM:\Software\WOW6432Node\Policies\Adobe\Acrobat Reader\DC\FeatureLockDown" -Name "bEnhancedSecurityInBrowser" -Value 0 -PropertyType DWORD -Force
}

_UninstallAdobe
_InstallAdobe
_InstallLatestPatch
_AdobeSettings
#+end_src

#+begin_src shell
./script.ps1
#+end_src

